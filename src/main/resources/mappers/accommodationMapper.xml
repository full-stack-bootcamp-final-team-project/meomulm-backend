<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.meomulm.accommodation.model.mapper.AccommodationMapper">
    <!-- 숙소 아이디를 기반으로 이미지 리스트 반환 -->
    <select id="selectAccommodationImagesById" resultType="AccommodationImage">
        SELECT accommodation_image_url
        FROM accommodation_image
        WHERE accommodation_id = #{accommodationId}
    </select>

    <!-- 돋보기 검색 - 숙소명, 지역명으로 숙소 검색 -->
    <select id="selectAccommodationByKeyword" resultType="SearchAccommodationResponse" parameterType="String">
        SELECT *
        FROM vw_searchpage_accommodation
        WHERE accommodation_name ILIKE '%' || #{keyword} || '%'
           OR accommodation_address ILIKE '%' || #{keyword} || '%'
    </select>


    <!-- 지역 별 가격 낮은 순(평점 높은 순x)으로 12개 -->
    <select id="selectAccommodationPopularByAddress" resultType="SearchAccommodationResponse">
        SELECT *
        FROM vw_searchpage_accommodation
        WHERE accommodation_address ILIKE '%' || #{keyword} || '%'
        ORDER BY min_price
        LIMIT 12
    </select>


    <!-- 지도 클릭 -> 현재 위치 기반의 반경 5KM 숙소를 지도에 노출 -->
    <select id="selectAccommodationByLocation" resultType="SearchAccommodationResponse">
        SELECT *
        FROM vw_searchpage_accommodation
        WHERE (
        6371 * acos(
        cos(radians(#{accommodationLatitude}))
        * cos(radians(accommodation_latitude))
        * cos(radians(accommodation_longitude) - radians(#{accommodationLongitude}))
        + sin(radians(#{accommodationLatitude}))
        * sin(radians(accommodation_latitude))
        )
        ) &lt;= 5
    </select>


    <!-- 숙소 상세 검색 -->
    <select id="selectAccommodationDetailById" resultType="AccommodationDetail">
        SELECT *
        FROM vw_accommodation_detail
        WHERE accommodation_id = #{accommodationId}
    </select>
</mapper>
